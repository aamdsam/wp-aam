pipeline {
    agent any
    environment {
        KUBE_CONTEXT = 'your-kube-context'  // Kube context if you have multiple clusters
        KUBERNETES_NAMESPACE = 'default'  // Replace with your namespace
    }

    stages {
        stage('Get Kubernetes Resources') {
            steps {
                script {
                    sh 'kubectl get ingress aam-ingress -n default -o wide'
                    sh 'kubectl get service aam-service -n default'
                    sh 'kubectl get pods -n default'
                }
            }
        }

        stage('Exec into Pod and Curl') {
            steps {
                script {
                    def podName = sh(script: "kubectl get pods -n default -o jsonpath='{.items[0].metadata.name}'", returnStdout: true).trim()
                    echo "Executing curl inside pod: ${podName}"
                    sh "kubectl exec -it ${podName} -n default -- curl http://aam-service:80"
                }
            }
        }
    }
}
